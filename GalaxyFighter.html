<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galaxy Fighter — Outer Space</title>
  <style>
    body,html{margin:0;height:100%;background:#000;color:#fff;font-family:monospace;}
    .wrap{display:grid;grid-template-rows:auto 1fr auto auto;place-items:center;min-height:100vh;padding:4px;gap:6px;}
    h1{margin:0;font-size:18px;color:#fff;}
    canvas{background:#000;border:2px solid #fff;image-rendering:pixelated;}
    .hud{display:flex;gap:10px;margin:4px;font-size:14px;}
    .hud span{padding:2px 6px;border:1px solid #fff;}
    button,select,input{margin:2px;padding:4px 8px;font-weight:bold;cursor:pointer;background:#111;color:#fff;border:1px solid #fff;}
    .settings{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;font-size:12px;}
    .settings label{margin-right:4px;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>GALAXY FIGHTER — LO-FI</h1>
    <canvas id="game" width="480" height="320" aria-label="Galaxy Fighter Canvas"></canvas>
    <div class="hud">
      <span>Score: <span id="hudScore">0</span></span>
      <span>Lives: <span id="hudLives">3</span></span>
      <span>Level: <span id="hudStage">1</span></span>
      <span>Hi: <span id="hudHi">0</span></span>
      <span>Weapon: <span id="hudWeap">PEW</span></span>
      <span>Multiplier: <span id="hudMult">1x</span></span>
    </div>
    <div>
      <button id="btnStart">Start</button>
      <button id="btnPause">Pause</button>
    </div>
    <div class="settings">
      <label>Spawn Rate <input type="range" id="spawnRate" min="30" max="120" value="60"></label>
      <label>Max Enemies <input type="number" id="maxEnemies" value="12" min="1" max="50"></label>
      <label><input type="checkbox" id="ultraLoFi"> Ultra-Lo-Fi (240×160)</label>
    </div>
  </div>
  <script>
  'use strict';
  let W=480,H=320; 
  const canvas=document.getElementById('game');
  const ctx=canvas.getContext('2d');
  const hudScore=document.getElementById('hudScore');
  const hudLives=document.getElementById('hudLives');
  const hudStage=document.getElementById('hudStage');
  const hudHi=document.getElementById('hudHi');
  const hudWeap=document.getElementById('hudWeap');
  const hudMult=document.getElementById('hudMult');
  const btnStart=document.getElementById('btnStart');
  const btnPause=document.getElementById('btnPause');
  const spawnRateSlider=document.getElementById('spawnRate');
  const maxEnemiesInput=document.getElementById('maxEnemies');
  const ultraLoFiChk=document.getElementById('ultraLoFi');
  const LS_KEY='galaxy.lowres.hi';
  const LS_SETTINGS='galaxy.lowres.settings';

  // Load saved settings
  const saved=JSON.parse(localStorage.getItem(LS_SETTINGS)||'{}');
  if(saved.spawnRate) spawnRateSlider.value=saved.spawnRate;
  if(saved.maxEnemies) maxEnemiesInput.value=saved.maxEnemies;
  if(saved.ultraLoFi) ultraLoFiChk.checked=saved.ultraLoFi;
  function saveSettings(){ localStorage.setItem(LS_SETTINGS,JSON.stringify({
    spawnRate:spawnRateSlider.value,maxEnemies:maxEnemiesInput.value,ultraLoFi:ultraLoFiChk.checked})); }
  spawnRateSlider.oninput=saveSettings; maxEnemiesInput.oninput=saveSettings; ultraLoFiChk.oninput=saveSettings;

  // Input
  const Key={};
  window.addEventListener('keydown',e=>{ Key[e.key]=true; if(e.key===' '){ e.preventDefault(); } if(e.key==='Enter'&&!game.running) start(); });
  window.addEventListener('keyup',e=>{ Key[e.key]=false; });

  // Game state
  const Weapons = { PEW:'PEW', MISSILE:'MISSILE', SEEK:'SEEK', MULTI:'MULTI' };
  const game={running:false,paused:false,t:0,level:1,levelKills:0,score:0,mult:1,hi:parseInt(localStorage.getItem(LS_KEY)||'0'),
    bannerTicks:0,
    player:{x:36,y:H/2,lives:3,cd:0,weapon:Weapons.PEW,weaponTimer:0},
    bullets:[],enemies:[],ebullets:[],powerups:[] };

  // Starfield (outer space)
  const stars=[]; // {x,y,s,layer}
  function initStars(){ stars.length=0; const layers=[0.4,0.8,1.2]; const counts=[40,40,40]; for(let L=0;L<3;L++){ for(let i=0;i<counts[L];i++){ stars.push({x:Math.random()*W,y:Math.random()*H,s:1+L,layer:layers[L]}); } } }
  function drawStars(){ ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#fff'; for(const st of stars){ ctx.fillRect(st.x,st.y,st.s>1?2:1,st.s>2?2:1); st.x-=0.5*st.layer; if(st.x<0){ st.x=W; st.y=Math.random()*H; } } }

  function start(){
    if(ultraLoFiChk.checked){W=240;H=160;} else {W=480;H=320;}
    canvas.width=W;canvas.height=H;
    initStars();
    game.running=true;game.paused=false;game.t=0;game.level=1;game.levelKills=0;game.mult=1;game.bannerTicks=60;
    game.score=0;game.player={x:36,y:H/2,lives:3,cd:0,weapon:Weapons.PEW,weaponTimer:0};
    game.bullets.length=0;game.enemies.length=0;game.ebullets.length=0;game.powerups.length=0;
    updateHUD();
  }
  function togglePause(){ if(game.running) game.paused=!game.paused; }
  btnStart.onclick=start; btnPause.onclick=togglePause;

  function updateHUD(){ hudScore.textContent=game.score; hudLives.textContent=game.player.lives; hudStage.textContent=game.level; hudHi.textContent=game.hi; hudWeap.textContent=game.player.weapon; hudMult.textContent=game.mult+'x'; }

  // Drawing
  function drawShip(x,y){ ctx.save(); ctx.translate(x,y); ctx.strokeStyle='#fff'; ctx.beginPath(); ctx.moveTo(10,0); ctx.lineTo(-8,-6); ctx.lineTo(-8,6); ctx.closePath(); ctx.stroke(); ctx.beginPath(); ctx.moveTo(-2,-3); ctx.lineTo(2,0); ctx.lineTo(-2,3); ctx.stroke(); ctx.restore(); }
  function drawAlien(e){ ctx.save(); ctx.translate(e.x,e.y); ctx.strokeStyle='#fff'; ctx.beginPath(); ctx.ellipse(0,0,8,4,0,0,Math.PI*2); ctx.stroke(); ctx.beginPath(); ctx.arc(0,-3,3,Math.PI,0); ctx.stroke(); ctx.restore(); }
  function drawBoss(b){ ctx.save(); ctx.translate(b.x,b.y); ctx.strokeStyle='#fff'; ctx.beginPath(); ctx.ellipse(0,0,22,10,0,0,Math.PI*2); ctx.stroke(); ctx.beginPath(); ctx.arc(0,-8,8,Math.PI,0); ctx.stroke(); // HP bar
    ctx.fillStyle='#fff'; ctx.fillRect(-24,-16,48*(b.hp/b.hpMax),2); ctx.restore(); }

  // Spawning
  function spawnEnemy(){ if(game.enemies.length>=parseInt(maxEnemiesInput.value)) return; const y=Math.max(10,Math.min(H-10,Math.random()*H)); game.enemies.push({x:W+12,y, vx:-1.2-(game.level*0.02), vy:(Math.random()*0.6-0.3), hp:1}); }
  function spawnBoss(){ const hp=40+(game.level*6); game.enemies.push({boss:true,x:W+40,y:H/2, vx:-0.5, vy:0.6, hp, hpMax:hp, fireCD:30, pattern:0}); game.bannerTicks=90; }

  // Power-ups
  function dropPower(x,y){ const r=Math.random(); const type = r<0.34? Weapons.MISSILE : (r<0.67? Weapons.SEEK : Weapons.MULTI); game.powerups.push({x,y, vx:-0.6, type}); }
  function updatePowerups(){ for(let i=game.powerups.length-1;i>=0;i--){ const p=game.powerups[i]; p.x+=p.vx; if(p.x<-10){ game.powerups.splice(i,1); continue; } if(Math.abs(p.x-game.player.x)<8 && Math.abs(p.y-game.player.y)<8){ game.player.weapon=p.type; game.player.weaponTimer=600; game.powerups.splice(i,1); } } }

  // Weapons
  function fire(){ const p=game.player; if(p.cd>0) return; p.cd=8; if(p.weaponTimer>0) p.weaponTimer--; else p.weapon=Weapons.PEW; switch(p.weapon){ case Weapons.PEW: game.bullets.push({x:p.x+8,y:p.y, vx:3, vy:0, dmg:1, kind:'pew'}); break; case Weapons.MISSILE: p.cd=12; game.bullets.push({x:p.x+8,y:p.y, vx:2, vy:0, dmg:3, kind:'missile'}); break; case Weapons.SEEK: p.cd=10; game.bullets.push({x:p.x+8,y:p.y, vx:2.4, vy:0, dmg:1, kind:'seek'}); break; case Weapons.MULTI: p.cd=12; game.bullets.push({x:p.x+8,y:p.y-3, vx:3, vy:-0.4, dmg:1, kind:'multi'}); game.bullets.push({x:p.x+8,y:p.y, vx:3, vy:0, dmg:1, kind:'multi'}); game.bullets.push({x:p.x+8,y:p.y+3, vx:3, vy:0.4, dmg:1, kind:'multi'}); break; } }
  function updateBullets(){ for(let i=game.bullets.length-1;i>=0;i--){ const b=game.bullets[i]; if(b.kind==='seek'){ let target=null,minDx=1e9; for(const e of game.enemies){ if(e.boss) continue; const dx=e.x-b.x; if(dx>0&&dx<minDx){ minDx=dx; target=e; } } if(target){ const dy=target.y-b.y; b.vy+=Math.sign(dy)*0.05; b.vy=Math.max(-1,Math.min(1,b.vy)); } } b.x+=b.vx; b.y+=b.vy; if(b.x>W+10||b.y<-10||b.y>H+10) game.bullets.splice(i,1); } }

  // Enemies
  function updateEnemies(){ for(let i=game.enemies.length-1;i>=0;i--){ const e=game.enemies[i]; if(e.boss){ if(e.x>W-120) e.x+=e.vx; else { e.x=W-120; e.y=Math.max(30,Math.min(H-30,e.y+e.vy)); if(game.t%45===0) enemyShoot(e,true); if(game.t%120===0) e.pattern=(e.pattern+1)%3; if(e.pattern===1&&game.t%30===0) enemyShootSpread(e); if(e.pattern===2&&game.t%90===0) enemyLaser(e); } } else { e.x+=e.vx; e.y=Math.max(10,Math.min(H-10,e.y+e.vy)); if(Math.random()<0.01) enemyShoot(e,false); } if(e.x<-20) game.enemies.splice(i,1); } }
  function enemyShoot(e,isBoss){ if(isBoss){ for(let k=-2;k<=2;k++){ game.ebullets.push({x:e.x-10,y:e.y, vx:-2.2, vy:k*0.4}); } } else { game.ebullets.push({x:e.x-8,y:e.y, vx:-2, vy:0}); } }
  function enemyShootSpread(e){ for(let a=-0.4;a<=0.4;a+=0.2){ game.ebullets.push({x:e.x-10,y:e.y, vx:-2, vy:a*5}); } }
  function enemyLaser(e){ for(let y=-20;y<=20;y+=5){ game.ebullets.push({x:e.x-12,y:e.y+y, vx:-3, vy:0}); } }
  function updateEBullets(){ for(let i=game.ebullets.length-1;i>=0;i--){ const b=game.ebullets[i]; b.x+=b.vx; b.y+=b.vy; if(b.x<-20||b.y<-20||b.y>H+20) game.ebullets.splice(i,1); } }

  // Collisions
  function collisions(){ // bullets vs enemies
    for(let i=game.enemies.length-1;i>=0;i--){ const e=game.enemies[i]; for(let j=game.bullets.length-1;j>=0;j--){ const b=game.bullets[j]; if(Math.abs(e.x-b.x)<(e.boss?20:8) && Math.abs(e.y-b.y)<(e.boss?12:6)){ e.hp-=b.dmg; game.bullets.splice(j,1); if(e.hp<=0){ const isBoss=!!e.boss; if(!isBoss){ game.levelKills++; if(Math.random()<0.25) dropPower(e.x,e.y); game.score+=Math.floor(20*game.mult); } else { game.score+=Math.floor(500*game.mult); } game.enemies.splice(i,1); if(isBoss){ nextLevel(); } break; } } } }
    const p=game.player; // player vs bullets/bodies
    for(let i=game.ebullets.length-1;i>=0;i--){ const b=game.ebullets[i]; if(Math.abs(b.x-p.x)<6 && Math.abs(b.y-p.y)<6){ game.ebullets.splice(i,1); hitPlayer(); break; } }
    for(const e of game.enemies){ if(Math.abs(e.x-p.x)<(e.boss?18:10) && Math.abs(e.y-p.y)<(e.boss?12:8)){ hitPlayer(); break; } }
  }

  function hitPlayer(){ if(!game.running) return; game.player.lives--; if(game.player.lives<=0){ gameOver(); } }

  // Level progression & spawn cadence
  function maybeSpawn(){ const rate=parseInt(spawnRateSlider.value); if(game.t%rate===0) spawnEnemy(); if(game.level>0 && game.levelKills>=Math.max(8, 10+Math.floor(game.level*0.5))){ game.levelKills=0; if(game.level%10===0){ spawnBoss(); } else { nextLevel(); } } }
  function nextLevel(){ game.level++; game.mult=Math.min(10,game.mult+1); game.bannerTicks=60; updateHUD(); }

  // Render
  function draw(){ drawStars(); // player
    drawShip(game.player.x,game.player.y);
    // player bullets
    ctx.fillStyle='#fff'; for(const b of game.bullets){ if(b.kind==='missile'){ ctx.fillRect(b.x-2,b.y-1,6,2); } else { ctx.fillRect(b.x-1,b.y-1,2,2); } }
    // enemies
    for(const e of game.enemies){ if(e.boss) drawBoss(e); else drawAlien(e); }
    // enemy bullets
    ctx.fillStyle='#fff'; for(const b of game.ebullets){ ctx.fillRect(b.x-1,b.y-1,2,2); }
    // powerups
    ctx.strokeStyle='#fff'; ctx.font='10px monospace'; ctx.textAlign='center'; for(const pwr of game.powerups){ ctx.strokeRect(pwr.x-4,pwr.y-4,8,8); const ch = pwr.type===Weapons.MISSILE?'M':(pwr.type===Weapons.SEEK?'S':'3'); ctx.fillText(ch, pwr.x, pwr.y+3); }
    // Banner
    if(game.bannerTicks>0){ game.bannerTicks--; ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(0,0,W,24); ctx.fillStyle='#fff'; ctx.font='bold 12px monospace'; ctx.textAlign='center'; ctx.fillText('LEVEL '+game.level, W/2, 16); }
  }

  // Loop
  function tick(){ if(!game.running){ drawTitle(); requestAnimationFrame(tick); return; } if(game.paused){ drawPause(); requestAnimationFrame(tick); return; } game.t++; if(Key['ArrowUp']||Key['w']) game.player.y-=2; if(Key['ArrowDown']||Key['s']) game.player.y+=2; if(Key[' ']) fire(); if(game.player.cd>0) game.player.cd--; game.player.y=Math.max(10,Math.min(H-10,game.player.y)); updateBullets(); updateEnemies(); updateEBullets(); updatePowerups(); collisions(); maybeSpawn(); draw(); updateHUD(); requestAnimationFrame(tick); }

  // UI overlays
  function drawTitle(){ ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#fff'; ctx.font='16px monospace'; ctx.textAlign='center'; ctx.fillText('GALAXY FIGHTER',W/2,H/2-10); ctx.font='12px monospace'; ctx.fillText('Enter: Start • Space: Fire • W/S or ↑/↓: Move',W/2,H/2+10); }
  function drawPause(){ ctx.fillStyle='rgba(0,0,0,0.6)'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#fff'; ctx.font='16px monospace'; ctx.textAlign='center'; ctx.fillText('PAUSED',W/2,H/2); }
  function gameOver(){ game.running=false; if(game.score>game.hi){ game.hi=game.score; localStorage.setItem(LS_KEY, game.hi); } updateHUD(); ctx.fillStyle='rgba(0,0,0,0.6)'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#fff'; ctx.font='16px monospace'; ctx.textAlign='center'; ctx.fillText('GAME OVER', W/2, H/2-10); ctx.font='12px monospace'; ctx.fillText('Score '+game.score+'  Hi '+game.hi, W/2, H/2+10); }

  // Boot
  initStars();
  requestAnimationFrame(tick);
  </script>
</body>
</html>
